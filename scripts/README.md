# 数据库管理脚本

## 一键清空数据库脚本

### 功能说明

这个脚本提供了一键清空数据库的功能，可以快速清空所有集合的数据，方便在开发、测试或重置环境时使用。

### 脚本文件

- `clear-database-simple.js` - 主要脚本文件
- `clear-database.ts` - TypeScript 源码文件

### 使用方法

#### 方法一：使用 npm 脚本（推荐）

```bash
# 清空数据库
npm run clear-db
```

#### 方法二：直接运行脚本

```bash
# 清空数据库
node scripts/clear-database-simple.js
```

### 清空的数据

脚本会清空以下集合的所有数据：

- `articles` - 所有文章数据
- `articleversions` - 所有文章版本历史
- `tasks` - 所有任务记录
- `users` - 所有用户数据（保留管理员账户）

### 安全警告

⚠️ **重要警告**：

- 此操作将**永久删除**所有数据
- 操作**不可撤销**
- 请确保在正确的环境中运行
- 建议在生产环境使用前进行数据备份

### 环境要求

- Node.js 14+
- MongoDB 数据库连接
- 正确的环境变量配置（MONGODB_URI）

### 配置说明

脚本使用环境变量 `MONGODB_URI` 来连接数据库，默认值为：
`mongodb://localhost:27017/luogu-saver-modern`

您可以通过 `.env` 文件或环境变量来设置自定义的连接字符串。

### 开发说明

如果您需要修改脚本，请编辑 `clear-database.ts` 文件，然后重新编译：

```bash
# 编译 TypeScript 文件
npm run build
```

### 注意事项

1. 脚本会跳过系统集合（以 `system.` 开头的集合）
2. 脚本会显示每个集合的清空结果
3. 脚本执行完成后会显示数据库的当前状态
4. 建议在运行前确认数据库连接配置正确

### 故障排除

如果脚本运行失败，请检查：

1. MongoDB 服务是否正在运行
2. 数据库连接字符串是否正确
3. 是否有足够的权限执行删除操作
4. 网络连接是否正常